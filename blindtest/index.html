<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blind Test Musical - Correction</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Blind Test Musical</h1>
      <p class="subtitle">Mode Multi-√âquipes en Temps R√©el</p>
      <span class="badge">Supabase</span>
    </div>

    <!-- √âcran de choix du mode -->
    <div class="mode-selection" id="modeSelection">
      <h2 style="color: #FFF; font-size: 1.2rem; margin-bottom: 30px; text-shadow: 4px 0 0 #E30000, -4px 0 0 #E30000, 0 4px 0 #E30000, 0 -4px 0 #E30000, 4px 4px 0 #000;">Choisissez votre mode</h2>
      <div style="display: grid; gap: 20px; max-width: 500px; margin: 0 auto;">
        <button onclick="showHostSetup()" class="genre-btn" style="padding: 30px; font-size: 1rem;">
          üë®‚Äçüè´ Je suis le PROF<br><span style="font-size: 0.7rem; opacity: 0.8;">(Cr√©er une session)</span>
        </button>
        <button onclick="showTeamJoin()" class="genre-btn" style="padding: 30px; font-size: 1rem;">
          üë• Je suis une √âQUIPE<br><span style="font-size: 0.7rem; opacity: 0.8;">(Rejoindre avec un code)</span>
        </button>
      </div>
    </div>

    <!-- √âcran de cr√©ation de session (HOST) -->
    <div class="host-setup" id="hostSetup" style="display: none;">
      <button onclick="backToMode()" style="position: absolute; top: 10px; left: 10px; padding: 10px 20px; font-size: 0.7rem; background: #888; border: 4px solid #000; border-radius: 8px; color: #FFF; cursor: pointer;">‚Üê Retour</button>
      
      <h2 style="color: #FFF; font-size: 1.2rem; margin-bottom: 20px; text-shadow: 4px 0 0 #E30000, -4px 0 0 #E30000, 0 4px 0 #E30000, 0 -4px 0 #E30000, 4px 4px 0 #000;">Configuration Host</h2>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; color: #000; font-size: 0.8rem; margin-bottom: 8px; font-weight: 700;">Votre nom :</label>
        <input type="text" id="hostName" placeholder="Prof Martin" style="width: 100%; padding: 12px; font-size: 0.9rem; border: 4px solid #000; border-radius: 8px; background: #FFF; font-family: 'Press Start 2P', monospace;">
      </div>
      
      <h3 style="color: #000; font-size: 0.9rem; margin: 20px 0; font-weight: 700;">Choisissez un genre musical</h3>
      <div class="genre-selection">
        <button class="genre-btn" onclick="createSession('all')">Tout Confondu</button>
        <button class="genre-btn" onclick="createSession('pop')">Pop</button>
        <button class="genre-btn" onclick="createSession('rock')">Rock</button>
        <button class="genre-btn" onclick="createSession('hip-hop')">Hip-Hop</button>
        <button class="genre-btn" onclick="createSession('electronic')">Electronic</button>
        <button class="genre-btn" onclick="createSession('rap-fr')">Rap FR</button>
      </div>
    </div>

    <!-- √âcran de rejoindre (√âQUIPE) -->
    <div class="team-join" id="teamJoin" style="display: none;">
      <button onclick="backToMode()" style="position: absolute; top: 10px; left: 10px; padding: 10px 20px; font-size: 0.7rem; background: #888; border: 4px solid #000; border-radius: 8px; color: #FFF; cursor: pointer;">‚Üê Retour</button>
      
      <h2 style="color: #FFF; font-size: 1.2rem; margin-bottom: 20px; text-shadow: 4px 0 0 #E30000, -4px 0 0 #E30000, 0 4px 0 #E30000, 0 -4px 0 #E30000, 4px 4px 0 #000;">Rejoindre une session</h2>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; color: #000; font-size: 0.8rem; margin-bottom: 8px; font-weight: 700;">Code de session (6 chiffres) :</label>
        <input type="text" id="sessionCode" placeholder="123456" maxlength="6" style="width: 100%; padding: 16px; font-size: 1.5rem; border: 4px solid #000; border-radius: 8px; background: #FFF; text-align: center; letter-spacing: 10px;">
      </div>
      
      <div style="margin-bottom: 30px;">
        <label style="display: block; color: #000; font-size: 0.8rem; margin-bottom: 8px; font-weight: 700;">Nom de votre √©quipe :</label>
        <input type="text" id="teamName" placeholder="Les Champions" style="width: 100%; padding: 12px; font-size: 0.9rem; border: 4px solid #000; border-radius: 8px; background: #FFF; font-family: 'Press Start 2P', monospace;">
      </div>
      
      <button onclick="joinSession()" class="submit-btn">Rejoindre la partie !</button>
    </div>

    <!-- √âcran d'attente HOST -->
    <div class="host-waiting" id="hostWaiting" style="display: none; text-align: center;">
      <div style="background: linear-gradient(180deg, #FDB528 0%, #E8A615 100%); border: 5px solid #000; border-radius: 16px; padding: 30px; margin-bottom: 30px; box-shadow: inset 0 4px 0 rgba(255, 255, 255, 0.3), 5px 5px 0 rgba(0, 0, 0, 0.3);">
        <h2 style="color: #000; font-size: 1rem; margin-bottom: 10px;">CODE DE SESSION :</h2>
        <div id="sessionCodeDisplay" style="font-size: 3rem; font-weight: 700; color: #000; letter-spacing: 15px; text-shadow: 3px 3px 0 rgba(255, 255, 255, 0.5);">------</div>
        <p style="color: #000; font-size: 0.7rem; margin-top: 10px;">Partagez ce code aux √©quipes</p>
      </div>
      
      <h3 style="color: #000; font-size: 0.9rem; margin-bottom: 20px; font-weight: 700;">√âquipes connect√©es :</h3>
      <div id="teamsList" style="display: grid; gap: 10px; margin-bottom: 30px;"></div>
      
      <button onclick="startGame()" class="submit-btn" id="startGameBtn" disabled>D√©marrer la partie (min 2 √©quipes)</button>
    </div>

    <!-- √âcran d'attente √âQUIPE -->
    <div class="team-waiting" id="teamWaiting" style="display: none; text-align: center;">
      <h2 style="color: #FFF; font-size: 1.2rem; margin-bottom: 20px; text-shadow: 4px 0 0 #E30000, -4px 0 0 #E30000, 0 4px 0 #E30000, 0 -4px 0 #E30000, 4px 4px 0 #000;">En attente du professeur...</h2>
      
      <div style="background: linear-gradient(180deg, rgba(248, 200, 100, 0.9) 0%, rgba(255, 255, 255, 0.9) 100%); border: 5px solid #000; border-radius: 12px; padding: 25px; margin-bottom: 25px;">
        <p style="color: #000; font-size: 0.8rem; margin-bottom: 10px;">Votre √©quipe :</p>
        <div id="yourTeamName" style="font-size: 1.3rem; font-weight: 700; color: #E30000; text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.5);">---</div>
      </div>
      
      <div class="spinner" style="margin: 30px auto;"></div>
      <p style="color: #000; font-size: 0.8rem; font-weight: 700;">Patientez pendant que d'autres √©quipes rejoignent...</p>
      
      <div id="waitingTeamsList" style="margin-top: 30px;"></div>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading" style="display: none;">
      <div class="spinner"></div>
      <p>Chargement des musiques...</p>
    </div>

    <!-- √âcran de jeu -->
    <div class="game-screen" id="gameScreen" style="display: none;">
      <div class="game-header">
        <div class="stat-card">
          <div class="stat-label">Score</div>
          <div class="stat-value" id="scoreDisplay">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Manche</div>
          <div class="stat-value" id="roundDisplay">1/10</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Temps</div>
          <div class="stat-value" id="timerDisplay">30</div>
        </div>
      </div>

      <!-- Lecteur audio -->
      <div class="audio-player">
        <div class="album-cover" id="albumCover">
          <img src="https://via.placeholder.com/240" alt="Album">
        </div>
        <button class="play-btn" id="playBtn" onclick="togglePlay()">Jouer</button>
        <p class="player-hint">√âcoutez l'extrait et devinez l'artiste</p>
      </div>

      <!-- Feedback -->
      <div class="feedback" id="feedback"></div>

      <!-- Zone de r√©ponse -->
      <div class="answer-zone">
        <h3>Qui est l'artiste ?</h3>
        <input 
          type="text" 
          class="answer-input" 
          id="answerInput" 
          placeholder="Entrez le nom de l'artiste..."
          onkeypress="handleKeyPress(event)"
        >
        <button class="submit-btn" onclick="checkAnswer()">Valider ma r√©ponse</button>
        <button class="skip-btn" onclick="skipSong()">Passer cette chanson</button>
      </div>
    </div>

    <!-- √âcran de fin -->
    <div class="end-screen" id="endScreen">
      <h2>Partie termin√©e</h2>
      <div class="final-score" id="finalScore">0</div>
      <p class="message" id="finalMessage">Bravo</p>
      <button class="restart-btn" onclick="restartGame()">Rejouer</button>
    </div>
  </div>

  <script src="script-supabase.js"></script>
</body>
</html>